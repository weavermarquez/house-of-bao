* New Error?

<oo><o>


#+begin_example
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
 FAIL  src/logic/tests/reflection.test.ts > Reflection Axiom > isCancelApplicable / cancel > property: survivors retain structure with fresh ids
Error: Property failed after 91 tests
{ seed: -156112294, path: "90:3:2:2:4:4:4:3", endOnFailure: true }
Counterexample: [

{"kind":"angle","children":[
 {"kind":"round","children":[]},
 {"kind":"round","children":[]}]},
{"kind":"round","children":[]}]
Shrunk 7 time(s)

Hint: Enable verbose mode in order to have the list of all failing values encountered during the run
 ❯ buildError node_modules/fast-check/lib/check/runner/utils/RunDetailsFormatter.js:156:19
 ❯ throwIfFailed node_modules/fast-check/lib/check/runner/utils/RunDetailsFormatter.js:165:11
 ❯ reportRunDetails node_modules/fast-check/lib/check/runner/utils/RunDetailsFormatter.js:178:16
 ❯ Module.assert node_modules/fast-check/lib/check/runner/Runner.js:61:9
 ❯ src/logic/tests/reflection.test.ts:123:10
    121| 
    122|     it("property: survivors retain structure with fresh ids", () => {
    123|       fc.assert(
       |          ^
    124|         fc.property(formNodeArb, formNodeArb, (pairRaw, contextRaw) => {
    125|           const base = materializeFormNode(pairRaw);

Caused by: AssertionError: expected 1 to be +0 // Object.is equality

- Expected
+ Received

- 0
+ 1

 ❯ src/logic/tests/reflection.test.ts:143:68
 ❯ Property.predicate node_modules/fast-check/lib/check/property/Property.js:14:54
 ❯ Property.run node_modules/fast-check/lib/check/property/Property.generic.js:43:33
 ❯ runIt node_modules/fast-check/lib/check/runner/Runner.js:14:30
 ❯ check node_modules/fast-check/lib/check/runner/Runner.js:54:11
 ❯ Module.assert node_modules/fast-check/lib/check/runner/Runner.js:57:17
 ❯ src/logic/tests/reflection.test.ts:123:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯

 Test Files  1 failed | 10 passed (11)
      Tests  1 failed | 103 passed (104)
   Start at  16:42:04
   Duration  1.93s

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
#+end_example


* Errors

#+begin_example
RERUN  rerun all tests

 ❯ src/logic/tests/reflection.property.test.ts (2 tests | 1 failed) 77ms
       × property: survivors retain structure with fresh ids 33ms
 ❯ src/logic/tests/reflection.test.ts (11 tests | 1 failed) 138ms
       × property: survivors retain structure with fresh ids 49ms
#+end_example

* Failed Test A

Semantically, an angle within an angle is void. 
: angle(angle()) == void
so
: angle(angle(angle())) === angle()

- I'm not so worried about this one.

#+begin_example
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 2 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
 FAIL  src/logic/tests/reflection.property.test.ts > Reflection Axiom > isReflectionApplicable / cancelReflection > property: survivors retain structure with fresh ids
Error: Property failed after 28 tests
{ seed: -1884482458, path: "27:4:3:4", endOnFailure: true }
Counterexample: [
{"kind":"angle","children":[{"kind":"angle","children":[]}]},
{"kind":"angle","children":[]}]
Shrunk 3 time(s)

Hint: Enable verbose mode in order to have the list of all failing values encountered during the run
 ❯ buildError node_modules/fast-check/lib/check/runner/utils/RunDetailsFormatter.js:156:19
 ❯ throwIfFailed node_modules/fast-check/lib/check/runner/utils/RunDetailsFormatter.js:165:11
 ❯ reportRunDetails node_modules/fast-check/lib/check/runner/utils/RunDetailsFormatter.js:178:16
 ❯ Module.assert node_modules/fast-check/lib/check/runner/Runner.js:61:9
 ❯ src/logic/tests/reflection.property.test.ts:27:10
     25| 
     26|     it("property: survivors retain structure with fresh ids", () => {
     27|       fc.assert(
       |          ^
     28|         fc.property(formNodeArb, formNodeArb, (pairRaw, contextRaw) => {
     29|           const base = materializeFormNode(pairRaw);

Caused by: AssertionError: expected 'angle:[angle:[angle:[]]]' to be 'angle:[]' // Object.is equality

Expected: "angle:[]"
Received: "angle:[angle:[angle:[]]]"

 ❯ src/logic/tests/reflection.property.test.ts:41:52
 ❯ Property.predicate node_modules/fast-check/lib/check/property/Property.js:14:54
 ❯ Property.run node_modules/fast-check/lib/check/property/Property.generic.js:43:33
 ❯ runIt node_modules/fast-check/lib/check/runner/Runner.js:14:30
 ❯ check node_modules/fast-check/lib/check/runner/Runner.js:54:11
 ❯ Module.assert node_modules/fast-check/lib/check/runner/Runner.js:57:17
 ❯ src/logic/tests/reflection.property.test.ts:27:10
#+end_example

* Failed Test B

So, what I'm seeing here is that we are running =collect= given the forest:
round(), angle_a(round()), angle_b(round(), round()).

And since we are now allowing the round() to annihilate with any of the rounds in either of the angle containers, the operation has multiple possibilities:
- case a: cancel w angle_a. then what remains is angle_b(round(), round()). Which was the expected behaviour.
- case b: cancel w angle_b. Then what remains is angle_a(round()), angle_b(round()). Which violates the test.

However, [angle_a(round()), angle_b(round())] is semantically identical to [angle(round(), round())].  So this isn't really a problem, IMO.


#+begin_example
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯
 FAIL  src/logic/tests/reflection.test.ts > Reflection Axiom > isCancelApplicable / cancel > property: survivors retain structure with fresh ids
Error: Property failed after 25 tests
{ seed: 1400708118, path: "24:5:5:5:5:0:2:3", endOnFailure: true }
Counterexample: [
  {"kind":"round","children":[]},
  
  {"kind":"angle","children":[
    {"kind":"round","children":[]},
    {"kind":"round","children":[]}]}
]
Shrunk 7 time(s)

Hint: Enable verbose mode in order to have the list of all failing values encountered during the run
 ❯ buildError node_modules/fast-check/lib/check/runner/utils/RunDetailsFormatter.js:156:19
 ❯ throwIfFailed node_modules/fast-check/lib/check/runner/utils/RunDetailsFormatter.js:165:11
 ❯ reportRunDetails node_modules/fast-check/lib/check/runner/utils/RunDetailsFormatter.js:178:16
 ❯ Module.assert node_modules/fast-check/lib/check/runner/Runner.js:61:9
 ❯ src/logic/tests/reflection.test.ts:107:10
    105| 
    106|     it("property: survivors retain structure with fresh ids", () => {
    107|       fc.assert(
       |          ^
    108|         fc.property(formNodeArb, formNodeArb, (pairRaw, contextRaw) => {
    109|           const base = materializeFormNode(pairRaw);

Caused by: AssertionError: expected [ { …(4) }, { …(4) } ] to have a length of 1 but got 2

- Expected
+ Received

- 1
+ 2

 ❯ src/logic/tests/reflection.test.ts:123:26
 ❯ Property.predicate node_modules/fast-check/lib/check/property/Property.js:14:54
 ❯ Property.run node_modules/fast-check/lib/check/property/Property.generic.js:43:33
 ❯ runIt node_modules/fast-check/lib/check/runner/Runner.js:14:30
 ❯ check node_modules/fast-check/lib/check/runner/Runner.js:54:11
 ❯ Module.assert node_modules/fast-check/lib/check/runner/Runner.js:57:17
 ❯ src/logic/tests/reflection.test.ts:107:10

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/2]⎯

#+end_example

* This 
#+begin_example
 Test Files  2 failed | 9 passed (11)
      Tests  2 failed | 102 passed (104)
   Start at  15:41:40
   Duration  1.96s

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
#+end_example
